<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ‚</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","Noto Sans TC",sans-serif;
  background: linear-gradient(150deg,#8b0000,#ff4d4d);
  color:#fff;
  padding:1.5em 0;
  text-align:center;
  overflow-x:hidden;
  position:relative;
}

/* é£„é›ª */
.snowflake {
  position: fixed;
  top: -10px;
  color: rgba(255,255,255,0.9);
  font-size: 1em;
  opacity: 0.9;
  animation: fall linear infinite;
  pointer-events: none;
}
@keyframes fall {0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(100vh) rotate(360deg);}}

h1{
  font-size:1.9em;
  font-weight:700;
  margin-top:0.3em;
  text-shadow:0 4px 10px rgba(0,0,0,0.35);
}

/* æœˆæ›†å®¹å™¨ */
.grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  width:92vw;
  max-width:420px;
  margin:1.2em auto 0;
  background:rgba(255,255,255,0.22);
  padding:10px 12px;
  border-radius:18px;
  backdrop-filter:blur(10px);
  box-shadow:0 4px 22px rgba(0,0,0,0.35);
  animation:fadeUp .7s ease-out;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}

.weekday{
  font-size:0.78em;
  color:#ffeaea;
  font-weight:600;
}

.day{
  background:white;
  border-radius:12px;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1em;
  font-weight:600;
  color:#b30000;
  cursor:pointer;
  box-shadow:0 2px 5px rgba(0,0,0,0.15);
  transition:transform .15s ease, box-shadow .15s ease;
}
.day:hover{
  transform:scale(1.04);
  box-shadow:0 3px 10px rgba(0,0,0,0.25);
}

.weekend{color:#ff2b2b !important;}

/* å½ˆçª— */
#modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,0.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}
.modal-box{
  background:white;
  color:#333;
  border-radius:18px;
  padding:26px;
  width:80%;
  max-width:320px;
  text-align:center;
  box-shadow:0 8px 25px rgba(0,0,0,0.35);
  animation:fadeUp .28s ease-out;
}
.modal-box h2{margin:0;color:#b30000;font-weight:700;}
button{background:#b30000;border:none;padding:8px 20px;border-radius:8px;color:white;cursor:pointer;margin-top:10px;font-size:.9em;font-weight:600;}
button:active{background:#800000;}

/* TokenéŒ¯èª¤æç¤º */
.deny{margin-top:5em;font-size:1.1em;}
</style>
</head>

<body>
<h2> ğŸ‚å°ˆå±¬è³´å°å§çš„ç”Ÿæ—¥æœˆæ›† ğŸ—“ï¸ </h2>
<div id="calendarContainer"></div>

<!-- å½ˆçª— -->
<div id="modal">
  <div class="modal-box">
    <h2 id="mTitle"></h2>
    <p id="mText"></p>
    <button onclick="closeModal()">é—œé–‰</button>
  </div>
</div>

<script>
/* é£„é›ªæ•ˆæœ */
for(let i=0;i<30;i++){
  const s=document.createElement('div');
  s.className='snowflake';
  s.textContent='â„ï¸';
  s.style.left=Math.random()*100+'vw';
  s.style.animationDuration=4+Math.random()*6+'s';
  s.style.fontSize=(10+Math.random()*16)+'px';
  document.body.appendChild(s);
}

/* ===== Token & gifts ===== */
const SECRET="20251221";
const token = new URL(location.href).searchParams.get("token");
let gifts={};

/* å…ˆæª¢æŸ¥ token */
if(token!==SECRET){
  document.body.innerHTML='<div class="deny">âŒ Token éŒ¯èª¤ï¼Œç„¡æ³•ç€è¦½</div>';
} else {
  fetch("gifts.json")
    .then(r=>r.json())
    .then(data=>{
      gifts=data;
      buildCalendar();
    })
    .catch(err=>{
      console.error("gifts.json è¼‰å…¥å¤±æ•—",err);
      document.body.innerHTML='<div class="deny">âŒ gifts.json è¼‰å…¥å¤±æ•—</div>';
    });
}

/* å»ºç«‹æœˆæ›† */
function buildCalendar() {
  const container = document.getElementById("calendarContainer");
  container.innerHTML = ''; // æ¸…ç©ºèˆŠå…§å®¹
  const grid = document.createElement("div");
  grid.className = "grid";
  container.appendChild(grid);

  const weekdays = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
  weekdays.forEach((w,i)=>{
    const e = document.createElement("div");
    e.className = "weekday" + ((i===0||i===6)?' weekend':'');
    e.textContent = w;
    grid.appendChild(e);
  });

  const y = 2025, m = 11; // 12æœˆ
  const first = new Date(y, m, 1);
  const days = new Date(y, m+1, 0).getDate();
  const start = first.getDay();

  for(let i=0;i<start;i++) grid.appendChild(document.createElement("div"));

  const today = new Date();
  const isDevMonth = today.getMonth() === 10; // 11æœˆé–‹ç™¼æ¨¡å¼

  for(let d=1; d<=days; d++){
    const cell = document.createElement("div");
    const date = new Date(y,m,d);
    cell.className="day";
    if(date.getDay()===0||date.getDay()===6) cell.classList.add("weekend");

    cell.textContent = d;

    // ===== é»é¸æ¢ä»¶ =====
    if(isDevMonth ||ï¼ˆdate <= today)){ 
      // å¯ä»¥é»
      cell.onclick = () => openGift(d);
    } else {
      // æœªåˆ°æ—¥æœŸä¸å¯é»
      cell.style.opacity = 0.4;
      cell.style.cursor = "default";
    }

    grid.appendChild(cell);
  }
}

/* å½ˆçª— */
function openGift(d){
  const text = gifts[d] || "é€™å¤©é‚„æ²’æœ‰ç‰¹åˆ¥å®‰æ’ ğŸ‰";
  document.getElementById("mTitle").textContent = `12/${d} ğŸ`;
  document.getElementById("mText").innerHTML = text.replace(/\n/g, "<br>");
  document.getElementById("modal").style.display = "flex";
}

function closeModal(){document.getElementById("modal").style.display="none";}
</script>
</body>
</html>